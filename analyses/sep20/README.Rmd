---
title: "Jordi Cuixart"
output:
  github_document:
    toc: true
    toc_depth: 2
---


```{r setup, include=FALSE, echo = FALSE}
# Basic knitr options
library(knitr)
opts_chunk$set(comment = NA, 
               echo = FALSE, 
               warning = FALSE, 
               message = FALSE, 
               error = TRUE, 
               cache = FALSE,
               fig.path = 'figures/')
```


```{r}
# Libraries
library(vilaweb)
library(rtweet)
library(tidyverse)
library(databrew)
library(translateR)
library(sentimentr) # https://github.com/trinker/sentimentr
require(RPostgreSQL)
require(readr)  
require(DBI)
library(webshot)
source('prepare_data.R')
# Utility for screenshotting tweets:
# https://github.com/lukehorvat/screenshot-tweet
```

# Summary

## The question 

Did Jordi Cuixart organize a "public and violent uprising" against the Spanish State ("alzarse pública y violentamente")? 

# The hypothesis

If Jordi Cuixart committed a public and violent uprising, we expect the following three conditions to be true:

1. Social media chatter about violence and Jordi Cuixart, particularly from the ideological adversaries of Cuixart (politicians opposed to Catalan independence) will be highest in the immediate aftermath of the violence.

2. Given the severity of the events, wikipedia and search engine data about Cuixart will be highest in the immediate aftermath of the violence.

3. Newspaper coverage about Cuixart will be hightest in the immediate aftermath of the violence.

## The results  

1. Hypothesis 1: REJECTED. Social media chatter about violence and Cuixart does not peak immediately after the supposed violent uprising, but rather after the entry into prison.

2. Hypothesis 2: REJECTED. Wikipedia and search engine data about Cuixart does not peak immediately after the supposed violent uprising, but rather after the entry into prison.

3. Hypothesis 3: REJECTED. Newspaper coverage about Cuixart does not peak immediately after the supposed violent uprising, but rather after the entry into prison.

## Conclusion

A public and violent uprising, were it to have taken place, would be a major, attention-worthy event. In the case of Jordi Cuixart, however, attention from social media, wikipedia, search engines, and the media did not follow the pattern of normal violent events. 

Rather, online attention to Cuixart peaked with the Judiciary's decision to imprison him. In other words, *imprisoning Cuixart was considered more attention-worthy than his supposed crime.* 

The data regarding the events of September/October 2017 are not consistent with a violent crime. The fact that Mr. Cuixart's imprisonment garnered more attention than his supposed actions are also not suggestive of a violent crime.


# Analysis

## Finding 1

```{r}
n_people <- length(unique(people_tweets$username))
n_tweets <- nrow(people_tweets)
```

_Social media chatter about violence and Jordi Cuixart, even when limited to the ideological adversaries of Cuixart (politicians opposed to Catalan independence) does not peak in the immediate days following the supposed crime._

We harvested tweets from `r n_people` well-known Spanish/Catalan politicians and political parties/groups during the supposed violent uprising organized by Cuixart (September 20th, 2017), as well as the following 2 days (September 21, 2017 and September 22nd, 2017). The list of the `r n_people` politicians was intentionally made up of politicians who are known to be against the independence of Catalonia. The `r n_people` are listed below:

```{r}
cat(paste0(sort(unique(people_tweets$username)), collapse = '\n'))
```

During the 3 days analyzed, the `r n_people` accounts generated `r n_tweets` tweets.

```{r, results = 'asis'}
detect_violence <- function(x){
  grepl('violen|violèn',x)
}
pd <- people_tweets %>%
  mutate(is_cuixart = grepl('cuixart', tolower(tweet)),
         is_jordis = grepl('jordis', tolower(tweet)) &
           !grepl('jordisa', tolower(tweet)),
         is_omnium = grepl('omnium', tolower(tweet)),
         is_violence = detect_violence(tolower(tweet)),
         is_rebelion = grepl('rebel', tolower(tweet)),
         is_sedition = grepl('sedici', tolower(tweet)))

show_screenshots <- function(the_ids,
                             the_data = picture_df){
  out <- 
    the_data %>%
    filter(id %in% the_ids)
  if(nrow(out) > 0){
    for(i in 1:nrow(out)){
      cat(paste0('\n*', as.character(out$the_dates[i]), ' ', as.character(out$the_times[i]), ' ', as.character(out$the_timezones[i]), '*\n'))
      cat(paste0('\n![screenshots/', out$file[i],'](screenshots/', out$file[i], ')\n'))
    }
  }
}
```

Of these `r n_tweets` tweets:  

- `r length(which(pd$is_cuixart))` mentioned the name of Cuixart. 

```{r, results = 'asis'}
show_screenshots(the_ids = pd$id[pd$is_cuixart])
```

- `r length(which(pd$is_jordis))` mentioned the "Jordis".

```{r, results = 'asis'}
show_screenshots(the_ids = pd$id[pd$is_jordis])
```

- `r length(which(pd$is_omnium))` mentioned "Omnium".

```{r, results = 'asis'}
show_screenshots(the_ids = pd$id[pd$is_omnium])
```

- `r length(which(pd$is_violence))` mentioned "violence", "violent", etc.

```{r, results = 'asis'}
show_screenshots(the_ids = pd$id[pd$is_violence])
```

- `r length(which(pd$is_rebelion))` mentioned "rebellion", "rebel", etc.

```{r, results = 'asis'}
show_screenshots(the_ids = pd$id[pd$is_rebelion])
```

- `r length(which(pd$is_sedition))` mentioned "sedition".

```{r, results = 'asis'}
show_screenshots(the_ids = pd$id[pd$is_sedition])
```

### Comparison with actual violent events

#### The "public and violent uprising"

```{r}
plot_data <- people_tweets_long %>%
  mutate(is_violence = detect_violence(tolower(tweet))) %>%
  filter(is_violence) %>%
  group_by(date) %>%
  tally
left <- data_frame(date = seq(min(plot_data$date),
                              max(plot_data$date),
                              by = 1))
plot_data <- left_join(left, plot_data)
plot_data <- plot_data %>% filter(date >= '2017-09-10',
                    date <=' 2017-10-20')
ggplot(data = plot_data,
       aes(x = date,
           y = n)) +
  geom_bar(stat = 'identity',alpha = 0.6) +
    # geom_smooth(se = FALSE) +
  theme_databrew() +
  theme(axis.text.x = element_text(angle = 90)) +
  scale_x_date(breaks = unique(plot_data$date)) +
  labs(x = 'Date',
       y = 'Tweets',
       title = 'Tweets by Spanish politicians with violence-related words',
       subtitle = '"Violence, violent"')

```


#### Violent protests in United States - August 2017 

In August 2017, violent protests took place in Charlottesville, South Carolina (USA). White supremacists marched, and many counter-protestors also convened. There were violent clashes between the two groups and on August 12th a man drove his car into a crowd, killing one person.

```{r}
pd <- usa %>%
  mutate(is_violence = grepl('violen', tolower(tweet))) %>%
  filter(is_violence) %>%
  # Adjust for time zone
  mutate(date = as.numeric(date)) %>%
  mutate(date = ifelse(as.numeric(substr(time, 1, 2)) <6,
                       date - 1,
                       date)) %>%
  mutate(date = as.Date(date, origin ='1970-01-01')) %>%
  group_by(date) %>%
  tally
left <- data_frame(date = seq(min(pd$date),
                              max(pd$date),
                              by = 1))
pd <- left_join(left, pd)
pd <- pd %>% filter(date >= '2017-08-01',
                    date <=' 2017-08-30')
ggplot(data = pd,
       aes(x = date,
           y = n)) +
  geom_bar(stat = 'identity',alpha = 0.6) +
  # geom_smooth(se = FALSE) +
  theme_databrew() +
  theme(axis.text.x = element_text(angle = 90)) +
  scale_x_date(breaks = unique(pd$date)) +
  labs(x = 'Date',
       y = 'Views',
       title = 'Tweets by US Congressmen with violence-related words',
       subtitle = '"Violence, violent"')

```

## Finding 2

_Wikipedia and search engine data about Cuixart does not peak immediately after the supposed violent uprising, but rather after the entry into prison._

#### Wikipedia page views after the "uprising"


```{r}
wiki <- pv %>%
  filter(person %in% c('Jordi Cuixart', 'Jordi Sànchez')) %>%
  filter(date >= '2017-09-15',
         date <= '2017-10-20')

pd <- wiki %>%
    group_by(date,person) %>%
  summarise(n = sum(views, na.rm = TRUE))
left <- data_frame(date = seq(min(pd$date),
                              max(pd$date),
                              by = 1))
pd <- left_join(left, pd)

ggplot(data = pd,
       aes(x = date,
           y = n,
           group = person)) +
  geom_bar(stat = 'identity',alpha = 0.6) +
  # geom_smooth(se = FALSE) +
  theme_databrew() +
  theme(axis.text.x = element_text(angle = 90)) +
  scale_x_date(breaks = unique(pd$date)) +
  labs(x = 'Date',
       y = 'Views',
       title = 'Wikipedia page-views for Jordi Cuixart and Jordi Sànchez',
       subtitle = 'Spanish, Catalan, and English languages') +
  facet_wrap(~person, scales = 'free_y',
             ncol = 1)
```

#### Wikipedia page views after a truly violent event

```{r}
wiki <- pv_char %>%
  # filter(person == 'Jordi Cuixart') %>%
  filter(date >= '2017-08-01',
         date <= '2017-08-31')

pd <- wiki %>%
    group_by(date,person) %>%
  summarise(n = sum(views, na.rm = TRUE))
left <- data_frame(date = seq(min(pd$date),
                              max(pd$date),
                              by = 1))
pd <- left_join(left, pd)

ggplot(data = pd,
       aes(x = date,
           y = n)) +
  geom_bar(stat = 'identity',alpha = 0.6) +
  # geom_smooth(se = FALSE) +
  theme_databrew() +
  theme(axis.text.x = element_text(angle = 90)) +
  scale_x_date(breaks = unique(pd$date)) +
  labs(x = 'Date',
       y = 'Tweets',
       title = 'Wikipedia page-views for Jason Kessler and Richard Spencer',
       subtitle = 'Spanish, Catalan, and English languages') +
  facet_wrap(~person,
             scales = 'free_y',
             ncol = 1)
```

#### Google search trends after the "uprising" 

```{r}
google_chart <- function(person = 'Jordi Cuixart',
                         dates = c('2017-07-01', '2017-12-30')){
  pd <- gt %>%
    filter(keyword == person) %>%
    filter(date >= dates[1],
           date <= dates[2])
  ggplot(data = pd,
         aes(x = date,
             y = hits)) +
    geom_line() +
    geom_area(alpha =0.6) +
    theme_databrew() +
    labs(x = 'Week ending on',
         y = 'Relative search load (%)',
         title = paste0('Google search trends for ', person)) +
    scale_x_date(breaks = unique(pd$date)) +
    theme(axis.text.x = element_text(angle = 90))
}

google_chart('Jordi Cuixart')
```

```{r}
google_chart('Jordi Sànchez')
```

#### Google search trends after a truly violent event


```{r}
google_chart('Jason Kessler',
             dates = as.Date(c('2017-07-01',
                               '2017-09-30')))
```

```{r}
google_chart('Richard Spencer',
             dates = as.Date(c('2017-07-01',
                               '2017-09-30')))
```

## Finding 3

_Newspaper coverage about Cuixart does not peak immediately after the supposed violent uprising, but rather after the entry into prison._

```{r}
plot_data <- newspaper_tweets %>%
  mutate(is_violence = detect_violence(tolower(tweet))) %>%
  filter(is_violence) %>%
 group_by(date,username) %>%
  tally
left <- expand.grid(date = seq(min(plot_data$date),
                              max(plot_data$date),
                              by = 1),
                   username = sort(unique(plot_data$username)))
plot_data <- left_join(left, plot_data)
plot_data <- plot_data %>% filter(date >= '2017-09-10',
                    date <=' 2017-10-20')
plot_data$n <- ifelse(is.na(plot_data$n), 0, plot_data$n)
ggplot(data = plot_data,
       aes(x = date,
           y = n,
           fill = username)) +
  geom_bar(stat = 'identity',alpha = 0.6) +
    # geom_smooth(se = FALSE) +
  theme_databrew() +
  theme(axis.text.x = element_text(angle = 90)) +
  scale_x_date(breaks = unique(plot_data$date)) +
  labs(x = 'Date',
       y = 'Tweets',
       title = 'Tweets by Spanish newspapers with violence-related words',
       subtitle = '"Violence, violent"') +
  scale_fill_manual(name = '',
                    values = databrew::make_colors(n = length(unique(plot_data$username))))
```


```{r}
plot_data <- newspaper_tweets %>%
  mutate(is_cuixart = grepl('cuixart', tolower(tweet))) %>%
  filter(is_cuixart) %>%
  group_by(date,username) %>%
  tally
left <- expand.grid(date = seq(min(newspaper_tweets$date),
                              max(newspaper_tweets$date),
                              by = 1),
                   username = sort(unique(plot_data$username)))
plot_data <- left_join(left, plot_data)
plot_data <- plot_data %>% filter(date >= '2017-09-10',
                    date <=' 2017-10-20')
plot_data$n <- ifelse(is.na(plot_data$n), 0, plot_data$n)
ggplot(data = plot_data,
       aes(x = date,
           y = n,
           fill = username)) +
  geom_bar(stat = 'identity',alpha = 0.6) +
    # geom_smooth(se = FALSE) +
  theme_databrew() +
  theme(axis.text.x = element_text(angle = 90)) +
  scale_x_date(breaks = unique(plot_data$date)) +
  labs(x = 'Date',
       y = 'Tweets',
       title = 'Tweets by Spanish newspapers about Cuixart') +
  scale_fill_manual(name = '',
                    values = databrew::make_colors(n = length(unique(plot_data$username))))
```


# Conclusion

# Appendix


## All tweets from politicians, 20-22 September

```{r, echo = F, results = 'asis'}
for(i in 1:nrow(picture_df)){
  this_file <- picture_df$file[i]
  new_person <- FALSE
  if(i == 1){
    new_person <- TRUE
  } else if(picture_df$person_dates[i] != picture_df$person_dates[i-1]){
    new_person <- TRUE
  }
  if(new_person){
    cat(paste0('\n### ', as.character(picture_df$person_dates[i]), '\n\n'))
  }
  cat(paste0('\n##### ', as.character(picture_df$the_dates[i]), ' ', as.character(picture_df$the_times[i]), ' ', as.character(picture_df$the_timezones[i]), '\n'))
  cat(paste0('\n![screenshots/', picture_df$file[i],'](screenshots/', picture_df$file[i], ')\n'))
}
```


## All tweets from politicians, 16-18 September

```{r, echo = F, results = 'asis'}
for(i in 1:nrow(picture_df2)){
  this_file <- picture_df2$file[i]
  new_person <- FALSE
  if(i == 1){
    new_person <- TRUE
  } else if(picture_df2$person_dates[i] != picture_df2$person_dates[i-1]){
    new_person <- TRUE
  }
  if(new_person){
    cat(paste0('\n### ', as.character(picture_df2$person_dates[i]), '\n\n'))
  }
  cat(paste0('\n##### ', as.character(picture_df2$the_dates[i]), ' ', as.character(picture_df2$the_times[i]), ' ', as.character(picture_df2$the_timezones[i]), '\n'))
  cat(paste0('\n![screenshots2/', picture_df2$file[i],'](screenshots2/', picture_df2$file[i], ')\n'))

}
```


## All newspaper headlines, 20-22 September

```{r, echo = F, results = 'asis'}
newspaper_df <- 
  data_frame(file = dir('newspaper_headlines')) %>%
  mutate(paper = unlist(lapply(lapply(strsplit(file, '_'), function(x){x[2]}), function(y){gsub('.jpg', '', y, fixed = T)}))) %>%
  mutate(date = as.Date(substr(file, 1, 10))) %>%
  mutate(file = paste0('newspaper_headlines/', file))

sub_newspapers <- newspaper_df %>%
  filter((date >= '2017-09-20'&
         date <= '2017-09-23'))
sub_newspapers <- sub_newspapers %>%
  arrange(date, paper)
for(i in 1:nrow(sub_newspapers)){
   this_file <- sub_newspapers$file[i]
  new_person <- FALSE
  if(i == 1){
    new_person <- TRUE
  } else if(sub_newspapers$date[i] != sub_newspapers$date[i-1]){
    new_person <- TRUE
  }
  if(new_person){
    cat(paste0('\n### ', as.character(sub_newspapers$date[i]), '\n\n'))
  }
  cat(paste0('\n##### ', as.character(sub_newspapers$date[i]), ', ',   as.character(sub_newspapers$paper[i]), '\n'))
  cat(paste0('\n![',this_file,'](', this_file, ')\n'))
}
```


## All newspaper headlines, 16-18 October

```{r, echo = F, results = 'asis'}
newspaper_df <- 
  data_frame(file = dir('newspaper_headlines')) %>%
  mutate(paper = unlist(lapply(lapply(strsplit(file, '_'), function(x){x[2]}), function(y){gsub('.jpg', '', y, fixed = T)}))) %>%
  mutate(date = as.Date(substr(file, 1, 10))) %>%
  mutate(file = paste0('newspaper_headlines/', file))

sub_newspapers <- newspaper_df #%>%
  filter((date >= '2017-10-16'&
         date <= '2017-10-18'))
sub_newspapers <- sub_newspapers %>%
  arrange(date, paper)
for(i in 1:nrow(sub_newspapers)){
   this_file <- sub_newspapers$file[i]
  new_person <- FALSE
  if(i == 1){
    new_person <- TRUE
  } else if(sub_newspapers$date[i] != sub_newspapers$date[i-1]){
    new_person <- TRUE
  }
  if(new_person){
    cat(paste0('\n### ', as.character(sub_newspapers$date[i]), '\n\n'))
  }
  cat(paste0('\n##### ', as.character(sub_newspapers$date[i]), ', ',   as.character(sub_newspapers$paper[i]), '\n'))
  cat(paste0('\n![',this_file,'](', this_file, ')\n'))
}
```

